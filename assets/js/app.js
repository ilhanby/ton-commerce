function getProducts(e,t){preloader("show"),$.ajax({url:window.location.origin+"/api?type=products&currency="+e+"&offset="+t,type:"GET",success:function(e){if("success"===e.status){let t=e.items,a="";t.forEach(function(e){a+=$("#product-sample").html().replace("$product_id",e.id).replace("$product_id",e.id).replace("$product_item_id",e.id).replace("$product_image",e.image).replace("$product_image_alt",e.name).replace("$product_name",e.name).replace("$product_price_html",e.price_html).replace("$product_price",e.price).replace("$product_discount_html",e.discount_html).replace("$product_description","")}),$("#product_list").append(a),$("#offset").val(parseInt($("#offset").val())+10),preloader("hide"),dynamicElementEvents()}},error:function(e){preloader("hide")}})}function getProduct(e,t){preloader("show"),$.ajax({url:window.location.origin+"/api?type=product&include="+t+"&currency="+e+"&offset=0",type:"GET",success:function(e){if("success"===e.status){let t=e.items,a="";t.forEach(function(e){a+=$("#product-sample").html().replace("$product_id",e.id).replace("$product_id",e.id).replace("$product_item_id",e.id).replace("$product_image",e.image).replace("$product_image_alt",e.name).replace("$product_name",e.name).replace("$product_price_html",e.price_html).replace("$product_price",e.price).replace("$product_discount_html",e.discount_html).replace("$product_description",e.description).replace("col-6 col-sm-6 col-lg-4 col-xl-3","col-12").replace("product-description d-none","product-description").replace("product-detail-banner d-none","product-detail-banner").replace("product-link","")}),$("#popup_product .modal-body #product_details").html(a),$("#popup_product").modal("show"),preloader("hide"),dynamicElementEvents()}},error:function(e){$("#popup_product").modal("hide"),preloader("hide")}}),dynamicElementEvents()}function popupProduct(e){getProduct($("#currency").val(),e)}function preloader(e){"hide"===e?($("#loader").hide(),$("#load_more").show()):"show"===e?($("#loader").show(),$("#load_more").hide()):$("#loader, #load_more").toggle()}function onScroll(){$(window).scrollTop()+$(window).height()>=$(document).height()-80&&$("#load_more").click()}async function loadTonPrice(){$.ajax({url:$ton_price_api_url,type:"GET",success:function(e){e.rates.TON.prices.USD&&(window.tonPrice=e.rates.TON.prices.USD)}})}async function sendTransaction(e,t){return await window.connector.sendTransaction({validUntil:Math.floor(new Date/1e3)+360,messages:[{address:t,amount:e}]})}window.onload=async()=>{let e=document.querySelector.bind(document);window.tonPrice=0,window.connector=new TonConnectSDK.TonConnect({manifestUrl:$ton_api_manifest_url}),window.tonweb=new TonWeb;let t=await window.connector.getWallets(),a=e("#payment_list");for(let n of t){if("tonkeeper"!==n.jsBridgeKey)continue;let o=document.createElement("div");o.classList.add("col-6","text-center");let r=document.createElement("button");r.classList.add("btn","btn-outline-primary","btn-block","btn-lg","w-100");let i=document.createElement("img");i.src=n.imageUrl,i.alt=n.name,i.classList.add("wallet-icon","m-0"),r.appendChild(i);let p=document.createElement("hr");r.appendChild(p);let c=document.createElement("span");c.classList.add("wallet-name"),c.innerText=n.name,r.appendChild(c),n.embedded||n.injected?r.onclick=()=>{window.connector.connected?(document.getElementById("ton_qrcode").innerHTML="",e("#popup_ton_info").style.display="block",e("#popup_ton_info").classList.add("show"),Telegram.WebApp.MainButton.setParams({is_visible:!1})):window.connector.connect({jsBridgeKey:n.jsBridgeKey})}:n.bridgeUrl?r.onclick=()=>{if(window.connector.connected)document.getElementById("ton_qrcode").innerHTML="",e("#popup_ton_info").style.display="block",e("#popup_ton_info").classList.add("show"),Telegram.WebApp.MainButton.setParams({is_visible:!1});else{let t=window.connector.connect({universalLink:n.universalLink,bridgeUrl:n.bridgeUrl});if("iphone"===Telegram.WebApp.platform||"android"===Telegram.WebApp.platform||"ios"===Telegram.WebApp.platform)Telegram.WebApp.openLink(t);else{let a=document.getElementById("ton_qrcode");a.innerHTML="<img src='"+n.imageUrl+"' class='wallet-icon mt-3'/><h3 class='text-center mt-3 mb-3'>"+n.name+"</h3>",new QRCode(a,{text:t,width:200,height:200,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H});let o=document.createElement("button");o.classList.add("btn","btn-primary","btn-block","btn-xl","mt-5"),o.innerText="Back",o.onclick=()=>{a.innerHTML="",e("#payment_list").style.display="flex"},a.appendChild(o),e("#payment_list").style.display="none"}}}:r.style.display="none",(n.embedded||n.injected||n.bridgeUrl)&&(o.appendChild(r),a.appendChild(o))}};var productModal=document.getElementById("popup_product");productModal.addEventListener("hidden.bs.modal",function(){$("#popup_product .modal-body #product_details").html(""),dynamicElementEvents()});var cartModal=document.getElementById("popup_cart");cartModal.addEventListener("hidden.bs.modal",function(){VIPWebApp.modeOrder=!1,VIPWebApp.updateTotalPrice(),dynamicElementEvents()}),cartModal.addEventListener("shown.bs.modal",function(){VIPWebApp.modeOrder=!0,VIPWebApp.updateTotalPrice(),dynamicElementEvents()});var tonModal=document.getElementById("popup_ton_info");function vipModalClose(){$("#popup_ton_info").removeClass("show"),$("#popup_ton_info").hide(),VIPWebApp.loadCart()}function dynamicElementEvents(){$(".product-link").click(function(e){e.preventDefault(),popupProduct($(this).data("id")),e.stopPropagation(),e.stopImmediatePropagation()}),$(".add-to-cart").click(function(e){e.preventDefault(),VIPWebApp.addToCart($(this).data("id")),VIPWebApp.viewCart(),e.stopPropagation(),e.stopImmediatePropagation()}),$(".cart-remove-item").click(function(e){e.preventDefault(),VIPWebApp.removeFromCart($(this).data("item-id")),VIPWebApp.loadCart(),e.stopPropagation(),e.stopImmediatePropagation()}),$(".cart-add-item").click(function(e){e.preventDefault(),VIPWebApp.addToCart($(this).data("item-id")),VIPWebApp.loadCart(),e.stopPropagation(),e.stopImmediatePropagation()})}tonModal.addEventListener("hidden.bs.modal",function(){VIPWebApp.loadCart(),dynamicElementEvents()});const VIPWebApp={initData:Telegram.WebApp.initData||"",initDataUnsafe:Telegram.WebApp.initDataUnsafe||{},MainButton:Telegram.WebApp.MainButton,PopupButton:Telegram.WebApp.PopupButton,ScanQrPopupParams:Telegram.WebApp.ScanQrPopupParams,modeOrder:!1,canPay:!1,totalPrice:0,currency:$("#currency").val(),cartData:[],init:async function(e){Telegram.WebApp.ready(),VIPWebApp.apiUrl=e.apiUrl,VIPWebApp.userId=e.userId,VIPWebApp.userHash=e.userHash,Telegram.WebApp.MainButton.setParams({is_visible:!1,text:"VIEW CART",color:"#0088CC"}).onClick(function(){VIPWebApp.canPay?VIPWebApp.paymentType():VIPWebApp.viewCart()}),VIPWebApp.expand(),VIPWebApp.loadCart()},expand:function(){Telegram.WebApp.expand()},close:function(){Telegram.WebApp.close()},formatPrice:function(e){return VIPWebApp.formatNumber(e,1,".",",")+" "+$("#currency").val()},formatNumber:function(e,t,a,n){var o=isFinite(+(e=(e+"").replace(/[^0-9+\-Ee.]/g,"")))?+e:0,r=isFinite(+t)?Math.abs(t):0,i="";return(i=(r?(function(e,t){if(-1===(""+e).indexOf("e"))return+(Math.round(e+"e+"+t)+"e-"+t);var a=(""+e).split("e"),n="";return+a[1]+t>0&&(n="+"),(+(Math.round(+a[0]+"e"+n+(+a[1]+t))+"e-"+t)).toFixed(t)})(o,r).toString():""+Math.round(o)).split("."))[0].length>3&&(i[0]=i[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,void 0===n?",":n)),(i[1]||"").length<r&&(i[1]=i[1]||"",i[1]+=Array(r-i[1].length+1).join("0")),i.join(void 0===a?".":a)},updateMainButton:function(){var e=Telegram.WebApp.MainButton;VIPWebApp.modeOrder?VIPWebApp.canPay?e.setParams({text:"PAY "+VIPWebApp.formatPrice(VIPWebApp.totalPrice)}):e.setParams({text:"VIEW CART"}):(VIPWebApp.canPay=!1,e.setParams({text:"VIEW CART"}))},updateTotalPrice:function(){var e=0;$(".js-item").each(function(){var t,a=$(this);e+=+a.data("item-price")*(+a.data("item-count")||0)}),VIPWebApp.canPay=e>0,VIPWebApp.totalPrice=e,VIPWebApp.currency=$("#currency").val(),VIPWebApp.updateMainButton()},viewCart:function(){VIPWebApp.loadCart(),$("#popup_cart").modal("show"),dynamicElementEvents()},paymentType:function(){$("#popup_payment").modal("show"),dynamicElementEvents()},viewPay:function(){VIPWebApp.makeOrder(),dynamicElementEvents()},addToCart:function(e){preloader("show");var t=sessionStorage.getItem("cart");(t=t?JSON.parse(t):{})[e]?t[e].count=t[e].count+1:$.ajax({url:window.location.origin+"/api?type=product&currency="+VIPWebApp.currency+"&include="+e,type:"GET",async:!1,success:function(a){t[e]={image:a.items[0].image,name:a.items[0].name,price:a.items[0].price,regular_price:a.items[0].regular_price,count:1}}}),sessionStorage.setItem("cart",JSON.stringify(t)),preloader("hide")},removeFromCart:function(e){var t=sessionStorage.getItem("cart");(t=t?JSON.parse(t):{})[e]&&(t[e].count>1?t[e].count=t[e].count-1:delete t[e]),sessionStorage.setItem("cart",JSON.stringify(t))},loadCart:function(){preloader("show");var e=sessionStorage.getItem("cart");e=e?JSON.parse(e):{};var t="";for(var a in e){let n=e[a].count,o=e[a].regular_price,r=e[a].price,i=e[a].image,p=e[a].name;t+='<div class="row js-item" data-item-id="'+a+'" data-item-regular-price="'+o+'" data-item-price="'+r+'" data-item-count="'+n+'">',t+='<div class="col-3">',t+='<img src="'+i+'" class="img-fluid" alt="'+p+'">',t+="</div>",t+='<div class="col-9">',t+='<div class="row">',t+='<div class="col-12">',t+="<h6>"+p+"</h6>",t+="</div>",t+='<div class="col-12">',t+='<div class="row">',t+='<div class="col-6">',t+='<span class="mb-0 text-secondary" style="font-size: 14px"><del>'+VIPWebApp.formatPrice(o)+"</del></span>",t+="<h5>"+VIPWebApp.formatPrice(r)+"</h5>",t+="</div>",t+='<div class="col-6">',t+='<div class="input-group">',t+='<div class="input-group-prepend">',t+='<button class="btn btn-outline-secondary cart-remove-item" type="button" data-item-id="'+a+'">-</button>',t+="</div>",t+='<input type="text" class="form-control text-center" value="'+n+'" readonly>',t+='<div class="input-group-append">',t+='<button class="btn btn-outline-secondary cart-add-item" type="button" data-item-id="'+a+'">+</button>',t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="</div>",t+="<hr>",Telegram.WebApp.enableClosingConfirmation(),Telegram.WebApp.MainButton.setParams({is_visible:!0})}""===t&&(t='<div class="row">',t+='<div class="col-12 my-5 text-center">',t+="<h4>Your cart is empty</h4>",t+="</div>",t+="</div>",VIPWebApp.modeOrder=!1,Telegram.WebApp.disableClosingConfirmation(),Telegram.WebApp.MainButton.setParams({is_visible:!1})),$("#cart_list").html(t),VIPWebApp.updateTotalPrice(),dynamicElementEvents(),preloader("hide")},removeCart:function(){sessionStorage.removeItem("cart")},makeOrder:async function(){if(preloader("show"),!VIPWebApp.canPay)return!1;if(VIPWebApp.modeOrder){var e={total_price:VIPWebApp.totalPrice,ton_price:window.tonPrice,currency:VIPWebApp.currency,order_data:sessionStorage.getItem("cart"),name:$("#ton_name").val(),email:$("#ton_email").val(),phone:$("#ton_phone").val(),country:$("#ton_country").val(),state:$("#ton_state").val(),zip:$("#ton_zip").val(),address:$("#ton_address").val()};VIPWebApp.userId&&VIPWebApp.userHash&&(e.user_id=VIPWebApp.userId,e.user_hash=VIPWebApp.userHash),e=JSON.stringify(e),VIPWebApp.apiRequest("order",{params:e},function(t){void 0!==t&&"success"===t.status?($("#loader_text").html("Confirm Payment in Tonkeeper App").removeClass("d-none"),sendTransaction(1e9*(t.items.amount/t.items.ton_price).toFixed(2),t.items.address).then(async t=>{$("#loader_text").html("Payment received. We provide our controls").removeClass("d-none"),t.boc&&VIPWebApp.apiRequest("order_check",{params:e,boc:t.boc},function(e){void 0!==e&&"success"===e.status?setTimeout(function(){Telegram.WebApp.disableClosingConfirmation(),Telegram.WebApp.close()},1e3):($("#loader_text").html("").addClass("d-none"),Telegram.WebApp.HapticFeedback.notificationOccurred("error"),Telegram.WebApp.showAlert("Insufficient Fund."),preloader("hide"))})}).catch(e=>{$("#loader_text").html("").addClass("d-none"),Telegram.WebApp.HapticFeedback.notificationOccurred("error"),Telegram.WebApp.showAlert("Insufficient Fund."),preloader("hide")})):($("#loader_text").html("").addClass("d-none"),Telegram.WebApp.HapticFeedback.notificationOccurred("error"),Telegram.WebApp.showAlert("Something went wrong. Please try again later."),preloader("hide"))})}},apiRequest:function(e,t,a){let n=VIPWebApp.initData||"",o=VIPWebApp.initDataUnsafe||"";$.ajax({url:window.location.origin+"/api/?type="+e,type:"POST",data:$.extend(t,{_auth:n,unsafe:o,type:e}),dataType:"json",xhrFields:{withCredentials:!0},success:function(e){a&&a(e)},error:function(e){a&&a({error:"Server error"})}})}};$(document).ready(function(){loadTonPrice(),setTimeout(loadTonPrice,2e4),$(window).scroll(onScroll),VIPWebApp.init({apiUrl:window.location.origin,userId:0,userHash:null}),$("#ton_send_transaction").on("click",function(e){if(e.preventDefault(),!1===$("#ton_form")[0].checkValidity())return $("#ton_form").addClass("was-validated"),!1;VIPWebApp.viewPay(),e.stopPropagation(),e.stopImmediatePropagation()}),$("#load_more").click(function(e){e.preventDefault(),getProducts($("#currency").val(),$("#offset").val()),e.stopPropagation(),e.stopImmediatePropagation()}),$("#load_more").click(),dynamicElementEvents();let e=setTimeout(async function(){window.connector.onStatusChange(e=>{null!==e&&($("#ton_qrcode").html(""),$("#payment_list").css("display","flex"),$("#popup_payment").modal("hide"),$("#popup_ton_info").modal("show"),Telegram.WebApp.MainButton.setParams({is_visible:!1}))}),clearTimeout(e)},5e3)});